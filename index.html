<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<title>Bubble Material Demo</title>

<style>
html,body{
  margin:0;
  background:#f2f2f2;
  touch-action:none;
}

#wrap{
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:14px;
  padding:20px;
}

.bubble{
  position:relative;
  width:100%;
  aspect-ratio:1/1;
  border-radius:50%;
  background:
    radial-gradient(circle at 30% 30%,
      rgba(255,255,255,.9),
      rgba(255,255,255,.4) 30%,
      rgba(200,200,200,.2) 55%,
      rgba(160,160,160,.25) 70%);
  box-shadow:
    inset 0 0 18px rgba(255,255,255,.8),
    inset 0 -8px 14px rgba(0,0,0,.15),
    0 6px 10px rgba(0,0,0,.15);
  overflow:hidden;
  touch-action:none;
}

.bubble::after{
  content:"";
  position:absolute;
  inset:0;
  border-radius:50%;
  background:radial-gradient(circle at var(--dent-x,50%) var(--dent-y,50%),
    rgba(0,0,0,.25),
    transparent 55%);
  opacity:var(--dent-opacity,0);
  transition:none;
}
</style>
</head>

<body>
<div id="wrap"></div>

<script>
const POP_SOUNDS=[...Array(3)].map((_,i)=>new Audio(`sounds/pop${i+1}.mp3`))
const INFLATE_SOUNDS=[1,2,3].map(i=>new Audio(`sounds/inflate${i}.mp3`))

const wrap=document.getElementById('wrap')

const bubbles=[]

for(let i=0;i<50;i++){
  const el=document.createElement('div')
  el.className='bubble'
  wrap.appendChild(el)
  bubbles.push(makeBubble(el))
}

function makeBubble(el){
  let pressure=0
  let state='idle' // idle | pressing | popped | inflating
  let dent=0

  el.addEventListener('pointerdown',()=>{
    if(state!=='idle')return
    state='pressing'
  })

  function pop(){
    state='popped'
    dent=1
    el.style.setProperty('--dent-x',`${30+Math.random()*40}%`)
    el.style.setProperty('--dent-y',`${30+Math.random()*40}%`)
    POP_SOUNDS[Math.floor(Math.random()*POP_SOUNDS.length)].cloneNode().play()
    setTimeout(()=>inflate(),600+Math.random()*600)
  }

  function inflate(){
    state='inflating'
    INFLATE_SOUNDS[Math.floor(Math.random()*INFLATE_SOUNDS.length)].cloneNode().play()
  }

  function update(){
    if(state==='pressing'){
      pressure+=0.04
      if(pressure>1) pop()
    }

    if(state==='popped'){
      dent+=0.08
      if(dent>1) dent=1
    }

    if(state==='inflating'){
      dent-=0.02
      if(dent<=0){
        dent=0
        pressure=0
        state='idle'
      }
    }

    render()
    requestAnimationFrame(update)
  }

  function render(){
    const bulge=1+pressure*0.08
    el.style.transform=`scale(${bulge})`
    el.style.setProperty('--dent-opacity',dent)
  }

  update()
  return{}
}
</script>
</body>
</html>

